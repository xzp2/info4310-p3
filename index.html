<html>
<head>
	<meta charset="utf-8"/>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="https://d3js.org/topojson.v2.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css?family=Arimo|Patua+One" rel="stylesheet">
<style>

	.filters{
		border:1px solid #222;
	}
	b{
		color:#FFF9C4;
	}
	body{
		background-color:#222;
		font-family: 'Arimo';
		color:#ddd;
		overflow:auto;
		font-size:12px;
	}
	.header {
		position:fixed;
		left:770px;
		display:inline-block;
		width:35%;
		height:100%;
		text-align:center;
		overflow:auto;
	}
	.title {
		width:100%;
		font-family: 'Patua One', cursive;
		font-size:30px;
	}
	.button {
		background-color:#444;
		border:none;
		padding:8px;
		margin:5px;
		border-radius:5px;
		font-size:13px;
		font-family: 'Arimo';
		color:#ddd;
		display:inline-block;
		width:200px;
		height:30px;
	}
	.filt {
		background-color:#444;
		border:none;
		padding:8px;
		margin:5px;
		border-radius:5px;
		font-size:12px;
		font-family: 'Arimo';
		color:#ddd;
		display:inline-block;
		width:200px;
		height:34px;
	}
	.filt:hover {
		background-color:#777;
		pointer:cursor;
	}

	.filt-all {
		color:#fff;
		background-color:#222;
		border:1px solid #aaa;
	}

	.reset {
		color:#fff;
		background-color:#222;
		border:1px solid #aaa;
	}

	.dot {
	  height: 13px;
	  width: 13px;
	  border-radius: 50%;
	  display: inline-block;
	  float:left;
	  margin-top:1px;
	  margin-left:10px;
	}
	
</style>
</head>

<body>

<script>
   	console.log('before');

	var width = 750;
	var height = 750;

	var projection = d3.geo.mercator()
		.center([-122.433701, 37.767683]) 
		.scale(225000)
		.translate([width / 2, height / 2]);

	var zoom = d3.behavior.zoom()
			    .scaleExtent([1, 8])
    			.on("zoom", limit);

	var svg = d3.select("body").append("svg")
		.attr("width", width)
		.attr("height", 700)
		.attr("viewBox", "55 400 590 5")
		.attr("style", "border:1px solid #555;")

		.call(zoom.on("zoom", function () {
		    svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")");
		  }))
		.append("g");

	function limit() {
	  	var t = d3.event.translate,
	    s = d3.event.scale;
	  	t[0] = Math.min(width / 2 * (s - 1), Math.max(width / 2 * (1 - s), t[0]));
	  	t[1] = Math.min(height / 2 * (s - 1) + 230 * s, Math.max(height / 2 * (1 - s) - 230 * s, t[1]));
	  zoom.translate(t);
	  g.style("stroke-width", 1 / s).attr("transform", "translate(" + t + ")scale(" + s + ")");
	}

	svg.append("image")
	          .attr("width", width)
	          .attr("height", height)
	          .attr("xlink:href", "sf-map.svg");

	function reset() {
		svg.attr("transform", "translate(0,0)" + " scale(1)");
		zoom.scale(1);
        zoom.translate([0, 0]);
	};

	function zoomin() {
		zoom.translate(0.1).scale(0.1);
		svg.attr("transform",
				        "translate(10,10)" +
				        "scale(" + 1.1 + ")"
				    )
			.call(zoom.on("zoom", function () {
			    svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
			  }))
			.append("g");
	}

	var species = {};
	var colors = {};

	d3.csv("/TreesTrimmed.csv", function(data) {

		d3.csv("/SpeciesList.csv", function(data2) {
			data2.map(function(d) {
				colors[d.Species] = d.Color;
				});

			data.map(function(d) {
				var treeCoord = projection([d.Longitude, d.Latitude]);
				if(species[d.qSpecies] == undefined) {
					species[d.qSpecies] = [];
				}
				species[d.qSpecies].push(treeCoord);
			});

			for(var s in species) {
				species[s].forEach(function(coords) {
					svg
					.append("circle")
					.attr("r",0.7)
					.attr("class", s)
					.attr("fill",colors[s])
					.attr("transform", function(d) {
						return "translate(" + coords + ")";
					});
				});
			}
		});
	});

	function select(category) {
		var circles = document.getElementsByTagName("circle");
		for(i=0;i<circles.length;i++) {
			circles[i].style.display="";
			if(circles[i].getAttribute("class") != category) {
				circles[i].style.display = "none";
			}
		}
	}


	function showAll() {
		var circles = document.getElementsByTagName("circle");
		for(i=0;i<circles.length;i++) {
			circles[i].style.display="";
		}
	}

	console.log("after");
</script>


<div class="header">
	<div class="loading" style="display:none">Loading...</div>
	<span class="title">San Francisco: An Urban Forest</span><br>
	These are the locations of the 20 most commonly found street trees in San Francisco!<br>You can <b>zoom</b> in and out by scrolling on your mousepad.<br>Click <b>reset</b> to see the map at its original scale.<br><br>
	<button class="filt reset" onclick="reset()">Reset Zoom to Original</button><br>
	<button class="filt filt-all" id="vb" onclick="showAll()">
	    Remove Filters
	</button>

	<div class="filters">
		<button class="filt" onclick="select('Platanus x hispanica :: Sycamore: London Plane')">
	    	<span class="dot" style="background-color:#4CAF50"></span>
	    	London Plane
	    </button>
		<button class="filt" id="vb" onclick="select('Pittosporum undulatum :: Victorian Box')">
			<span class="dot" style="background-color:#E91E63"></span>
	        Victorian Box
	    </button>
	    <button class="filt" onclick="select('Tristaniopsis laurina :: Swamp Myrtle')">
	    	<span class="dot" style="background-color:#FFC107"></span>
	    	Swamp Myrtle
	    </button>
	    <button class="filt" onclick="select('Arbutus Marina :: Hybrid Strawberry Tree')">
	    	<span class="dot" style="background-color:#1976D2"></span>
	    	Strawberry
	    </button>
	    <button class="filt" onclick="select('Magnolia grandiflora :: Southern Magnolia')">
	    	<span class="dot" style="background-color:#F5F5F5"></span>
	    	Bull Bay
	    </button>
	     <button class="filt" onclick="select('Ginkgo biloba :: Maidenhair Tree')">
	    	<span class="dot" style="background-color:#AFB42B"></span>
	    	Maidenhair
	    </button>
	    <button class="filt" onclick="select('Metrosideros excelsa :: New Zealand Xmas Tree')">
	    	<span class="dot" style="background-color:#f44336"></span>
	    	Pohutukawa
	    </button>
	    <button class="filt" onclick="select('Prunus serrulata Kwanzan :: Kwanzan Flowering Cherry')">
	    	<span class="dot" style="background-color:#673AB7"></span>
	    	Kwanzan Cherry
	    </button>
	    <button class="filt" onclick="select('Prunus cerasifera :: Cherry Plum')">
	    	<span class="dot" style="background-color:#FFEB3B"></span>
	    	Cherry Plum
	    </button>
	    <button class="filt" onclick="select('Eriobotrya deflexa :: Bronze Loquat')">
	    	<span class="dot" style="background-color:#FF9E80"></span>
	    	Bronze Loquat
	    </button>
	    <button class="filt" onclick="select('Pyrus calleryana :: Ornamental Pear')">
	    	<span class="dot" style="background-color:#C5E1A5"></span>
	    	Ornamental Pear
	    </button>
	    <button class="filt" onclick="select('Olea europaea :: Olive Tree')">
	    	<span class="dot" style="background-color:#303F9F"></span>
	    	Olive Tree
	    </button>
	    <button class="filt" onclick="select('Ficus microcarpa nitida Green Gem :: Indian Laurel Fig Tree Green Gem')">
	    	<span class="dot" style="background-color:#00BCD4"></span>
	    	Green Gem
	    </button>
	    <button class="filt" onclick="select('Callistemon citrinus :: Lemon Bottlebrush')">
	    	<span class="dot" style="background-color:#FFF9C4"></span>
	    	Lemon Bottlebrush
	    </button>
	    <button class="filt" onclick="select('Acacia melanoxylon :: Blackwood Acacia')">
	    	<span class="dot" style="background-color:#7B1FA2"></span>
	    	Blackwood Acacia
	    </button>
	     <button class="filt" onclick="select('Maytenus boaria :: Mayten')">
	    	<span class="dot" style="background-color:#00796B"></span>
	    	Mayten
	    </button>
	    <button class="filt" onclick="select('Ulmus parvifolia :: Chinese Elm')">
	    	<span class="dot" style="background-color:#d32f2f"></span>
	    	Chinese Elm
	    </button>
	    <button class="filt" onclick="select('Prunus serrulata :: Ornamental Cherry')">
	    	<span class="dot" style="background-color:#e57373"></span>
	    	Ornamental Cherry
	    </button>
	    <button class="filt" onclick="select('Corymbia ficifolia :: Red Flowering Gum')">
	    	<span class="dot" style="background-color:#FF9800"></span>
	    	Red Flowering Gum
	    </button>
	    <button class="filt" onclick="select('Lophostemon confertus :: Brisbane Box')">
	    	<span class="dot" style="background-color:#2196F3"></span>
	    	Brisbane Box
	    </button>



	</div>

</div>

</body>
</html>
